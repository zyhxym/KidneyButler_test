<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0,width=device-width,user-scalable=0,maximum-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>肾事管家</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <div class="tips">
        <img src="./img/tips.png" alt="">
    </div>
    <div class="main">
        <div class="logo">
            <img src="./img/logo@2x.png" alt="">
        </div>
        <h1>肾事管家</h1>
        <p class="top">让每一位慢性肾病患者得到有效管理</p>
        <p> 提高预期寿命</p>
        <div class="btn">
            <img src="./img/Button@2x.png" alt="">
        </div>
        <div class="bg"></div>
    </div>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script src="./js/zepto.min.js"></script>
    <script src="./js/useragent-base.js"></script>
    <script src="./js/ua-device.js"></script>
    <script>
        $(function () {
            function GetQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }
            //判断是否为微信浏览器
            function is_weixin() {
                var ua = navigator.userAgent.toLowerCase();
                if (ua.match(/MicroMessenger/i) == "micromessenger") {
                    return true;
                } else {
                    return false;
                }
            };

            // 获取签名的参数
            var path = GetQueryString('path');
            var otherInfo = window.location.href.split('path='+path)[1];
            fullPath = path + otherInfo;

            var option = {
                title: '肾事管家',
                desc: '让每一位慢性肾病患者得到有效管理提高预期寿命',
                link: "http://testpatient.haihonghospitalmanagement.com/share/share.html",
                imgUrl: 'http://testpatient.haihonghospitalmanagement.com/share/logo.png'
            };
            $.get('http://121.43.107.106:4050/api/v1/wechat/settingConfig?' + encodeURIComponent(fullPath) + '&role=patient', function (res) {
                wx.config({
                    beta: true,
                    debug: false,
                    appId: res.results.appId,
                    timestamp: res.results.timestamp,
                    nonceStr: res.results.nonceStr,
                    signature: res.results.signature,
                    jsApiList: [
                        'onMenuShareTimeline',
                        'onMenuShareAppMessage',
                        'onMenuShareQQ',
                        'onMenuShareWeibo',
                        'onMenuShareQZone',
                        'setBounceBackground'
                    ]
                });
                wx.ready(function () {
                    wx.onMenuShareTimeline(option);
                    wx.onMenuShareQQ(option);
                    wx.onMenuShareAppMessage({
                        title: '肾事管家',
                        desc: '让每一位慢性肾病患者得到有效管理提高预期寿命',
                        link: 'http://testpatient.haihonghospitalmanagement.com/share/share.html?path=' + path, // 这里替换成下载地址，如果是要分享下载链接的话
                        imgUrl: 'http://testpatient.haihonghospitalmanagement.com/share/img/logo.png'
                    });
                });
                wx.error(function (res) {
                    console.log('分享失败')
                });
            });


            window.alert = function (name) {
                var iframe = document.createElement("IFRAME");
                iframe.style.display = "none";
                iframe.setAttribute("src", 'data:text/plain,');
                document.documentElement.appendChild(iframe);
                window.frames[0].window.alert(name);
                iframe.parentNode.removeChild(iframe);
            }

            var input = window.navigator.userAgent,
                output = uaDevice(input);

            $('.tips').on('touchstart', function (ev) {
                $(this).hide();
            });

            console.log(output)

            // todo 根据不同的类型手机，跳转到不同的应用市场,目前就分安卓和ios
            function link() {
                var linkUrl = '';
                if (output.os.name === 'Android') {
                    linkUrl = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.ionicframework.kidneybutler';
                    // if (output.device.manufacturer === 'Xiaomi') {
                    //     linkUrl = 'http://app.mi.com/details?id=com.ionicframework.kidney879540';
                    // } else {
                    //     linkUrl = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.ionicframework.kidneybutler';
                    // }
                }
                return linkUrl;
            }


            $('.btn').on('touchstart', function () {
                if (is_weixin()) {
                    $('.tips').show();
                    return;
                }
                if (output.os.name === 'Android') {
                    window.location.href = link();
                    return;
                }
                if (output.device.manufacturer === 'Apple') {
                    alert('敬请期待');
                    return;
                }
            });


        });
    </script>
</body>

</html>